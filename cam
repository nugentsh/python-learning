# https://github.com/OlafenwaMoses/ImageAI/releases/download/2.0.2/imageai-2.0.2-py3-none-any.whl
# https://github.com/OlafenwaMoses/ImageAI/releases/download/1.0/resnet50_coco_best_v2.0.1.h5


import RPi.GPIO as gpi
import time
from time import sleep
import pygame as pg
from picamera import picamera


#pip install tensorflow
#pip install numpy
#pip install scipy
#pip install opencv-python
#pip install pillow
#pip install matplotlib
#pip install h5py
#pip install keras
camera = picamera()

#to test camera, give 10 sec preview
#camera.start_preview()
#sleep(10)
#camera.stop_preview()

#rotate image x degrees
#camera.rotation = x

pg.mixer.init()
pg.mixer.music.load("") #file name here


gpi.setwarnings(False)
gpi.setmode(gpi.BCM)#

gpi.setup(11, gpi.IN) #GPIO17 INPUTbutton
gpi.setup(13, gpi.IN) #GPIO27 PIRsensor

gpi.setup(18, gpi.OUT) #GPIO24 Speaker
#gpi.setup(16, gpi.OUT) #GPIO23

from detection import detections
user = 0
if length(detections)>0:
    user = 1
    
def user_detect('/home/pi/Desktop/image.jpg')
    #function to analyse image

if gpi.input(11):
    print('button 1 triggered')
    camera.start_preview()
    sleep(3)
    camera.capture('/home/pi/Desktop/image.jpg')
    camera.stop_preview()
    user_detect(image)
    
    if gpi.input(13):
        pg.mixer.music.play()
        #gpi.output(18, True)
        print('User detected, message relayed')
    else:
        print('Input triggered, but user not present')

